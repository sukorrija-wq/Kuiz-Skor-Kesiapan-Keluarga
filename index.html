<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kuiz Skor Kesiapan Keluarga ‚Äì Cek Tahap Perlindungan Anda</title>
  <meta name="description" content="Jawab 1 minit kuiz mudah untuk lihat skor kesiapan kewangan keluarga anda. Dapatkan cadangan tindakan dan jana poster untuk dikongsi!" />
  <meta property="og:title" content="Kuiz Skor Kesiapan Keluarga" />
  <meta property="og:description" content="Jawab 1 minit kuiz untuk lihat skor kesiapan kewangan anda & dapatkan cadangan tindakan." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://sukorrija-wq.github.io/Kuiz-Skor-Kesiapan-Keluarga/og-image.png" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="icon" href="favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg{background:radial-gradient(1200px 600px at 10% -10%, rgba(14,165,233,.25), transparent 60%),
                 radial-gradient(1200px 600px at 110% 10%, rgba(99,102,241,.25), transparent 60%)}
  </style>
  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "YOUR_TOKEN_HERE"}'></script>
</head>
<body class="min-h-screen gradient-bg text-slate-800">
  <header class="max-w-3xl mx-auto px-4 pt-10 pb-4">
    <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">Kuiz <span class="text-sky-600">Skor Kesiapan Keluarga</span></h1>
    <p class="mt-2 text-slate-600">Ambil masa ~1 minit. Ketahui skor 0‚Äì100 dan cadangan tindakan. 
      <span class="inline-flex items-center gap-2 bg-white/70 px-2 py-1 rounded-lg ml-2 text-sm">üõ°Ô∏è Bukan nasihat kewangan; tujuan maklumat umum sahaja.</span>
    </p>
    <div id="visits" class="mt-2 text-xs text-slate-500"></div>
  </header>

  <main class="max-w-3xl mx-auto px-4 pb-20">
    <div class="bg-white/80 backdrop-blur rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
      <div class="p-6 sm:p-8">
        <!-- Lead capture -->
        <div class="grid sm:grid-cols-2 gap-4 mb-6">
          <label class="block">
            <span class="text-sm font-medium text-slate-700">Nama (pilihan)</span>
            <input id="name" type="text" placeholder="cth: Sukor" class="mt-1 w-full rounded-xl border-slate-300 focus:border-sky-500 focus:ring-sky-500" />
          </label>
          <label class="block">
            <span class="text-sm font-medium text-slate-700">Status pekerjaan</span>
            <select id="job" class="mt-1 w-full rounded-xl border-slate-300 focus:border-sky-500 focus:ring-sky-500">
              <option value="tetap">Gaji tetap</option>
              <option value="sendiri">Sendiri / gig / komisen</option>
            </select>
          </label>
        </div>

        <form id="quiz" class="space-y-6">
          <!-- questions ... (sama macam sebelum ini) -->

          <button type="submit" class="w-full sm:w-auto px-6 py-3 rounded-xl bg-sky-600 text-white font-semibold hover:bg-sky-700 active:scale-[.99]">Kira Skor</button>
        </form>

        <!-- Result -->
        <section id="result" class="hidden mt-10">
          <div class="flex items-center justify-between gap-4 flex-wrap">
            <h2 class="text-2xl font-bold">Keputusan</h2>
            <button id="resetBtn" class="px-4 py-2 rounded-lg border font-medium">Ulang Kuiz</button>
          </div>

          <div class="mt-6 grid sm:grid-cols-2 gap-6 items-start">
            <div>
              <div class="mb-3 text-sm text-slate-600">Skor kesiapan anda</div>
              <div class="w-full h-4 bg-slate-200 rounded-full overflow-hidden">
                <div id="bar" class="h-4 rounded-full transition-all" style="width:0%"></div>
              </div>
              <div class="mt-3 flex items-baseline gap-3">
                <div id="score" class="text-4xl font-extrabold">0</div>
                <div id="label" class="text-lg font-semibold"></div>
              </div>
              <p id="desc" class="mt-3 text-slate-700"></p>

              <div class="mt-6 grid gap-3">
                <a id="toCalc" href="https://sukorrija-wq.github.io/hibah-calc/" target="_blank" rel="noopener" class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700">Kira Pelan Ganti Gaji &rarr;</a>
                <button id="shareBtn" class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl border font-semibold">Kongsi keputusan</button>
                <button id="dlPoster" class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl border font-semibold">Muat turun poster</button>
                <a id="waBtn" href="#" target="_blank" class="hidden inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-700">WhatsApp saya</a>
              </div>
            </div>

            <div class="bg-slate-50 rounded-xl p-4 border">
              <canvas id="posterCanvas" class="w-full rounded-lg" width="1080" height="1350"></canvas>
              <p class="text-xs text-slate-500 mt-2">Tip: Muat turun poster dan kongsi di Facebook/WhatsApp. Ajak rakan buat kuiz ini.</p>
            </div>
          </div>
        </section>

        <p class="mt-10 text-xs text-slate-500">Penafian: Kuiz ini hanyalah panduan umum. Keputusan tidak menjamin kelulusan atau manfaat mana-mana produk. Pertimbangkan bajet dan keperluan anda. Elakkan istilah ‚Äúsimpanan‚Äù untuk produk perlindungan semata-mata.</p>
      </div>
    </div>

    <footer class="max-w-3xl mx-auto text-center text-xs text-slate-500 mt-6">
      Dibangunkan oleh <span class="font-medium">Lisa ChatGPT</span>, Powered by <span class="font-medium">Sukor Rija Legacy</span>. ¬© <script>document.write(new Date().getFullYear())</script>
    </footer>
  </main>

  <!-- Modal WhatsApp CTA -->
  <div id="waModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl shadow-xl max-w-md w-full overflow-hidden">
      <div class="p-6">
        <h3 class="text-xl font-bold">Terus WhatsApp Sukor?</h3>
        <p class="mt-2 text-slate-600 text-sm">Nak saya bantu semak skor & cadangkan pelan bajet ikut kemampuan anda?</p>
        <div class="mt-5 grid gap-3 sm:grid-cols-2">
          <a id="waGoBtn" href="#" target="_blank" class="inline-flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-700">WhatsApp sekarang</a>
          <button id="waLaterBtn" class="px-4 py-3 rounded-xl border font-semibold">Nanti dulu</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const WHATSAPP_NUMBER = "+60169514414"; 
    const $ = (sel) => document.querySelector(sel);

    function clamp(n, min, max){return Math.min(Math.max(n, min), max)}
    function badgeColor(score){
      if(score >= 80) return ['Mantap', 'Kedudukan anda baik. Kekalkan disiplin dan pertimbangkan menaikkan perlindungan mengikut kemampuan.', '#059669'];
      if(score >= 60) return ['OK', 'Asas agak kukuh. Boleh mantapkan perlindungan pendapatan & medical card jika ada ruang.', '#0ea5e9'];
      if(score >= 40) return ['Rentan', 'Ada beberapa jurang penting. Mula dengan pelan ganti gaji bajet (cth RM50‚ÄìRM90) dan bina dana kecemasan.', '#f59e0b'];
      return ['Bahaya', 'Banyak jurang kritikal. Mulakan tindakan minimum: pelan ganti gaji bajet & bina dana kecemasan.', '#ef4444'];
    }

    // ... (fungsi drawPoster, computeScore, animateBar, showResult sama macam sebelum ini)

    document.getElementById('quiz').addEventListener('submit', (e)=>{
      e.preventDefault();
      const score = computeScore(e.target);
      showResult(score);
      window.scrollTo({top: document.getElementById('result').offsetTop - 16, behavior: 'smooth'});
      // ---- Auto CTA WhatsApp ----
      try{
        const shown = localStorage.getItem('kesiapan:waPrompted');
        if(!shown){
          const name = (document.getElementById('name').value||'').trim();
          const msg = encodeURIComponent(`Assalamualaikum, saya ${name||'‚Äî'}. Skor Kesiapan saya ${Math.round(score)}/100. Mohon bantu semak & cadangkan pelan bajet.`);
          const waLink = `https://wa.me/${WHATSAPP_NUMBER.replace('+','')}?text=${msg}`;
          const waBtn = document.getElementById('waGoBtn');
          waBtn.href = waLink;
          document.getElementById('waModal').classList.remove('hidden');
          document.getElementById('waModal').classList.add('flex');
        }
      }catch{ /* ignore */ }
    });

    // Modal handlers
    (function initWAModal(){
      const modal = document.getElementById('waModal');
      const later = document.getElementById('waLaterBtn');
      const go = document.getElementById('waGoBtn');
      function close(){ modal.classList.add('hidden'); modal.classList.remove('flex'); }
      later?.addEventListener('click', ()=>{ try{ localStorage.setItem('kesiapan:waPrompted','1'); }catch{} close(); });
      go?.addEventListener('click', ()=>{ try{ localStorage.setItem('kesiapan:waPrompted','1'); }catch{} close(); });
      modal?.addEventListener('click', (ev)=>{ if(ev.target===modal){ close(); } });
      window.addEventListener('keydown', (ev)=>{ if(ev.key==='Escape' && !modal.classList.contains('hidden')) close(); });
    })();
      const score = computeScore(e.target);
      showResult(score);
      window.scrollTo({top: document.getElementById('result').offsetTop - 16, behavior: 'smooth'});
      // Auto show WhatsApp CTA selepas kira skor
      const waBtn = document.getElementById('waBtn');
      if(waBtn){
        const msg = encodeURIComponent('Hai, saya baru siap Kuiz Skor Kesiapan Keluarga. Boleh bantu semak pelan ganti gaji saya?');
        waBtn.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
        waBtn.classList.remove('hidden');
      }
    });

    document.getElementById('toCalc').addEventListener('click', async ()=>{
      fetch('https://api.countapi.xyz/hit/kesiapan/klik-calc');
    });

    // Count visits
    (async ()=>{
      const NS="kesiapan", KEY="sukor-kuiz";
      await fetch(`https://api.countapi.xyz/create?namespace=${NS}&key=${KEY}&value=0`);
      const r = await fetch(`https://api.countapi.xyz/hit/${NS}/${KEY}`);
      const {value} = await r.json();
      document.getElementById('visits').textContent = `üëÄ Dilihat ${value} kali`;
    })();

    document.getElementById('shareBtn').addEventListener('click', async ()=>{
      const name = ($('#name').value || '').trim();
      const score = $('#score').textContent;
      const text = `Skor Kesiapan Keluarga saya: ${score}/100${name?` (Nama: ${name})`:''}. Cuba kuiz ini & kira pelan ganti gaji anda! #SukorRijaLegacy`;
      const url = location.href.split('#')[0];
      try{
        if(navigator.share){ await navigator.share({title: 'Kuiz Skor Kesiapan Keluarga', text, url}); }
        else{
          await navigator.clipboard.writeText(text + '\n' + url);
          alert('Keputusan disalin. Boleh tampal di media sosial/WhatsApp.');
        }
      }catch(err){ console.log(err); }
    });
  </script>
</body>
</html>
